# Flag emoji to country mapping (ISO codes)
flag_to_country:
  "🇺🇦": "UKR"
  "🇷🇺": "RUS"
  "🇺🇸": "USA"
  "🇬🇧": "GBR"
  "🇫🇷": "FRA"
  "🇩🇪": "DEU"
  "🇮🇹": "ITA"
  "🇪🇸": "ESP"
  "🇵🇱": "POL"
  "🇨🇿": "CZE"
  "🇭🇺": "HUN"
  "🇷🇴": "ROU"
  "🇧🇬": "BGR"
  "🇬🇷": "GRC"
  "🇭🇷": "HRV"
  "🇸🇮": "SVN"
  "🇸🇰": "SVK"
  "🇱🇹": "LTU"
  "🇱🇻": "LVA"
  "🇪🇪": "EST"
  "🇫🇮": "FIN"
  "🇸🇪": "SWE"
  "🇳🇴": "NOR"
  "🇩🇰": "DNK"
  "🇳🇱": "NLD"
  "🇧🇪": "BEL"
  "🇱🇺": "LUX"
  "🇨🇭": "CHE"
  "🇦🇹": "AUT"
  "🇮🇪": "IRL"
  "🇵🇹": "PRT"
  "🇮🇸": "ISL"
  "🇲🇹": "MLT"
  "🇨🇾": "CYP"
  "🇲🇰": "MKD"
  "🇦🇱": "ALB"
  "🇲🇪": "MNE"
  "🇧🇦": "BIH"
  "🇷🇸": "SRB"
  "🇽🇰": "XKX"
  "🇹🇷": "TUR"
  "🇬🇪": "GEO"
  "🇦🇲": "ARM"
  "🇦🇿": "AZE"
  "🇰🇿": "KAZ"
  "🇺🇿": "UZB"
  "🇰🇬": "KGZ"
  "🇹🇯": "TJK"
  "🇹🇲": "TKM"
  "🇲🇳": "MNG"
  "🇨🇳": "CHN"
  "🇯🇵": "JPN"
  "🇰🇷": "KOR"
  "🇰🇵": "PRK"
  "🇹🇼": "TWN"
  "🇭🇰": "HKG"
  "🇲🇴": "MAC"
  "🇻🇳": "VNM"
  "🇱🇦": "LAO"
  "🇰🇭": "KHM"
  "🇹🇭": "THA"
  "🇲🇾": "MYS"
  "🇸🇬": "SGP"
  "🇧🇳": "BRN"
  "🇵🇭": "PHL"
  "🇮🇩": "IDN"
  "🇲🇲": "MMR"
  "🇧🇩": "BGD"
  "🇱🇰": "LKA"
  "🇳🇵": "NPL"
  "🇧🇹": "BTN"
  "🇲🇻": "MDV"
  "🇮🇳": "IND"
  "🇵🇰": "PAK"
  "🇦🇫": "AFG"
  "🇮🇷": "IRN"
  "🇮🇶": "IRQ"
  "🇸🇾": "SYR"
  "🇱🇧": "LBN"
  "🇯🇴": "JOR"
  "🇵🇸": "PSE"
  "🇮🇱": "ISR"
  "🇸🇦": "SAU"
  "🇾🇪": "YEM"
  "🇴🇲": "OMN"
  "🇦🇪": "ARE"
  "🇶🇦": "QAT"
  "🇰🇼": "KWT"
  "🇧🇭": "BHR"
  "🇪🇬": "EGY"
  "🇱🇾": "LBY"
  "🇹🇳": "TUN"
  "🇩🇿": "DZA"
  "🇲🇦": "MAR"
  "🇪🇭": "ESH"
  "🇲🇷": "MRT"
  "🇲🇱": "MLI"
  "🇳🇪": "NER"
  "🇹🇩": "TCD"
  "🇸🇩": "SDN"
  "🇪🇷": "ERI"
  "🇩🇯": "DJI"
  "🇸🇴": "SOM"
  "🇪🇹": "ETH"
  "🇰🇪": "KEN"
  "🇺🇬": "UGA"
  "🇷🇼": "RWA"
  "🇧🇮": "BDI"
  "🇹🇿": "TZA"
  "🇲🇿": "MOZ"
  "🇿🇼": "ZWE"
  "🇿🇦": "ZAF"
  "🇳🇦": "NAM"
  "🇧🇼": "BWA"
  "🇱🇸": "LSO"
  "🇸🇿": "SWZ"
  "🇲🇬": "MDG"
  "🇰🇲": "COM"
  "🇲🇺": "MUS"
  "🇸🇨": "SYC"
  "🇨🇦": "CAN"
  "🇲🇽": "MEX"
  "🇧🇷": "BRA"
  "🇦🇷": "ARG"
  "🇨🇱": "CHL"
  "🇵🇪": "PER"
  "🇨🇴": "COL"
  "🇻🇪": "VEN"
  "🇪🇨": "ECU"
  "🇧🇴": "BOL"
  "🇵🇾": "PRY"
  "🇺🇾": "URY"
  "🇬🇾": "GUY"
  "🇸🇷": "SUR"
  "🇬🇫": "GUF"
  "🇫🇰": "FLK"
  "🇦🇺": "AUS"
  "🇳🇿": "NZL"
  "🇵🇬": "PNG"
  "🇫🇯": "FJI"
  "🇸🇧": "SLB"
  "🇻🇺": "VUT"
  "🇳🇨": "NCL"
  "🇵🇫": "PYF"
  "🇼🇫": "WLF"
  "🇹🇴": "TON"
  "🇰🇮": "KIR"
  "🇹🇻": "TUV"
  "🇳🇷": "NRU"
  "🇵🇼": "PLW"
  "🇲🇭": "MHL"
  "🇫🇲": "FSM"
  "🇵🇦": "PAN"
  "🇨🇷": "CRI"
  "🇳🇮": "NIC"
  "🇭🇳": "HND"
  "🇸🇻": "SLV"
  "🇬🇹": "GTM"
  "🇧🇿": "BLZ"
  "🇯🇲": "JAM"
  "🇭🇹": "HTI"
  "🇩🇴": "DOM"
  "🇨🇺": "CUB"
  "🇧🇧": "BRB"
  "🇹🇹": "TTO"
  "🇬🇩": "GRD"
  "🇱🇨": "LCA"
  "🇻🇨": "VCT"
  "🇦🇬": "ATG"
  "🇰🇳": "KNA"
  "🇩🇲": "DMA"
  "🇧🇸": "BHS"
  "🇰🇾": "CYM"
  "🇹🇨": "TCA"
  "🇦🇮": "AIA"
  "🇻🇬": "VGB"
  "🇲🇸": "MSR"
  "🇬🇵": "GLP"
  "🇲🇶": "MTQ"
  "🇧🇱": "BLM"
  "🇲🇫": "MAF"
  "🇸🇽": "SXM"
  "🇨🇼": "CUW"
  "🇦🇼": "ABW"
  "🇧🇶": "BES"

# Country centroids for fallback geolocation
country_centroids:
  UKR:
    lat: 48.3794
    lon: 31.1656
  RUS:
    lat: 61.5240
    lon: 105.3188
  USA:
    lat: 39.8283
    lon: -98.5795
  GBR:
    lat: 55.3781
    lon: -3.4360
  FRA:
    lat: 46.2276
    lon: 2.2137
  DEU:
    lat: 51.1657
    lon: 10.4515
  ITA:
    lat: 41.8719
    lon: 12.5674
  ESP:
    lat: 40.4637
    lon: -3.7492
  POL:
    lat: 51.9194
    lon: 19.1451
  CZE:
    lat: 49.8175
    lon: 15.4730
  HUN:
    lat: 47.1625
    lon: 19.5033
  ROU:
    lat: 45.9432
    lon: 24.9668
  BGR:
    lat: 42.7339
    lon: 25.4858
  GRC:
    lat: 39.0742
    lon: 21.8243
  HRV:
    lat: 45.1000
    lon: 15.2000
  SVN:
    lat: 46.1512
    lon: 14.9955
  SVK:
    lat: 48.6690
    lon: 19.6990
  LTU:
    lat: 55.1694
    lon: 23.8813
  LVA:
    lat: 56.8796
    lon: 24.6032
  EST:
    lat: 58.5953
    lon: 25.0136
  FIN:
    lat: 61.9241
    lon: 25.7482
  SWE:
    lat: 60.1282
    lon: 18.6435
  NOR:
    lat: 60.4720
    lon: 8.4689
  DNK:
    lat: 56.2639
    lon: 9.5018
  NLD:
    lat: 52.1326
    lon: 5.2913
  BEL:
    lat: 50.8503
    lon: 4.3517
  LUX:
    lat: 49.8153
    lon: 6.1296
  CHE:
    lat: 46.8182
    lon: 8.2275
  AUT:
    lat: 47.5162
    lon: 14.5501
  IRL:
    lat: 53.4129
    lon: -8.2439
  PRT:
    lat: 39.3999
    lon: -8.2245
  ISL:
    lat: 64.9631
    lon: -19.0208
  MLT:
    lat: 35.9375
    lon: 14.3754
  CYP:
    lat: 35.1264
    lon: 33.4299
  MKD:
    lat: 41.6086
    lon: 21.7453
  ALB:
    lat: 41.1533
    lon: 20.1683
  MNE:
    lat: 42.7087
    lon: 19.3744
  BIH:
    lat: 43.9159
    lon: 17.6791
  SRB:
    lat: 44.0165
    lon: 21.0059
  XKX:
    lat: 42.6026
    lon: 20.9030
  TUR:
    lat: 38.9637
    lon: 35.2433
  GEO:
    lat: 42.3154
    lon: 43.3569
  ARM:
    lat: 40.0691
    lon: 45.0382
  AZE:
    lat: 40.1431
    lon: 47.5769
  KAZ:
    lat: 48.0196
    lon: 66.9237
  UZB:
    lat: 41.3775
    lon: 64.5853
  KGZ:
    lat: 41.2044
    lon: 74.7661
  TJK:
    lat: 38.5358
    lon: 71.0965
  TKM:
    lat: 38.9697
    lon: 59.5563
  MNG:
    lat: 46.8625
    lon: 103.8467
  CHN:
    lat: 35.8617
    lon: 104.1954
  JPN:
    lat: 36.2048
    lon: 138.2529
  KOR:
    lat: 35.9078
    lon: 127.7669
  PRK:
    lat: 40.3399
    lon: 127.5101
  TWN:
    lat: 23.6978
    lon: 120.9605
  HKG:
    lat: 22.3193
    lon: 114.1694
  MAC:
    lat: 22.1987
    lon: 113.5439
  VNM:
    lat: 14.0583
    lon: 108.2772
  LAO:
    lat: 19.8563
    lon: 102.4955
  KHM:
    lat: 12.5657
    lon: 104.9910
  THA:
    lat: 15.8700
    lon: 100.9925
  MYS:
    lat: 4.2105
    lon: 108.9758
  SGP:
    lat: 1.3521
    lon: 103.8198
  BRN:
    lat: 4.5353
    lon: 114.7277
  PHL:
    lat: 12.8797
    lon: 121.7740
  IDN:
    lat: -0.7893
    lon: 113.9213
  MMR:
    lat: 21.9162
    lon: 95.9560
  BGD:
    lat: 23.6850
    lon: 90.3563
  LKA:
    lat: 7.8731
    lon: 80.7718
  NPL:
    lat: 28.3949
    lon: 84.1240
  BTN:
    lat: 27.5142
    lon: 90.4336
  MDV:
    lat: 3.2028
    lon: 73.2207
  IND:
    lat: 20.5937
    lon: 78.9629
  PAK:
    lat: 30.3753
    lon: 69.3451
  AFG:
    lat: 33.9391
    lon: 67.7100
  IRN:
    lat: 32.4279
    lon: 53.6880
  IRQ:
    lat: 33.2232
    lon: 43.6793
  SYR:
    lat: 34.8021
    lon: 38.9968
  LBN:
    lat: 33.8547
    lon: 35.8623
  JOR:
    lat: 30.5852
    lon: 36.2384
  PSE:
    lat: 31.9522
    lon: 35.2332
  ISR:
    lat: 31.0461
    lon: 34.8516
  SAU:
    lat: 23.8859
    lon: 45.0792
  YEM:
    lat: 15.5527
    lon: 48.5164
  OMN:
    lat: 21.4735
    lon: 55.9754
  ARE:
    lat: 24.0002
    lon: 53.9998
  QAT:
    lat: 25.3548
    lon: 51.1839
  KWT:
    lat: 29.3117
    lon: 47.4818
  BHR:
    lat: 26.0667
    lon: 50.5577
  EGY:
    lat: 26.8206
    lon: 30.8025
  LBY:
    lat: 26.3351
    lon: 17.2283
  TUN:
    lat: 33.8869
    lon: 9.5375
  DZA:
    lat: 28.0339
    lon: 1.6596
  MAR:
    lat: 31.7917
    lon: -7.0926
  ESH:
    lat: 24.2155
    lon: -12.8858
  MRT:
    lat: 21.0079
    lon: -10.9408
  MLI:
    lat: 17.5707
    lon: -3.9962
  NER:
    lat: 17.6078
    lon: 8.0817
  TCD:
    lat: 15.4542
    lon: 18.7322
  SDN:
    lat: 12.8628
    lon: 30.2176
  ERI:
    lat: 15.1794
    lon: 39.7823
  DJI:
    lat: 11.8251
    lon: 42.5903
  SOM:
    lat: 5.1521
    lon: 46.1996
  ETH:
    lat: 9.1450
    lon: 40.4897
  KEN:
    lat: -0.0236
    lon: 37.9062
  UGA:
    lat: 1.3733
    lon: 32.2903
  RWA:
    lat: -1.9403
    lon: 29.8739
  BDI:
    lat: -3.3731
    lon: 29.9189
  TZA:
    lat: -6.3690
    lon: 34.8888
  MOZ:
    lat: -18.6657
    lon: 35.5296
  ZWE:
    lat: -19.0154
    lon: 29.1549
  ZAF:
    lat: -30.5595
    lon: 22.9375
  NAM:
    lat: -22.9576
    lon: 18.4904
  BWA:
    lat: -22.3285
    lon: 24.6849
  LSO:
    lat: -29.6099
    lon: 28.2336
  SWZ:
    lat: -26.5225
    lon: 31.4659
  MDG:
    lat: -18.7669
    lon: 46.8691
  COM:
    lat: -11.6455
    lon: 43.3333
  MUS:
    lat: -20.3484
    lon: 57.5522
  SYC:
    lat: -4.6796
    lon: 55.4920
  CAN:
    lat: 56.1304
    lon: -106.3468
  MEX:
    lat: 23.6345
    lon: -102.5528
  BRA:
    lat: -14.2350
    lon: -51.9253
  ARG:
    lat: -38.4161
    lon: -63.6167
  CHL:
    lat: -35.6751
    lon: -71.5430
  PER:
    lat: -9.1900
    lon: -75.0152
  COL:
    lat: 4.5709
    lon: -74.2973
  VEN:
    lat: 6.4238
    lon: -66.5897
  ECU:
    lat: -1.8312
    lon: -78.1834
  BOL:
    lat: -16.2902
    lon: -63.5887
  PRY:
    lat: -23.4425
    lon: -58.4438
  URY:
    lat: -32.5228
    lon: -55.7658
  GUY:
    lat: 4.8604
    lon: -58.9302
  SUR:
    lat: 3.9193
    lon: -56.0278
  GUF:
    lat: 3.9339
    lon: -53.1258
  FLK:
    lat: -51.7963
    lon: -59.5236
  AUS:
    lat: -25.2744
    lon: 133.7751
  NZL:
    lat: -40.9006
    lon: 174.8860
  PNG:
    lat: -6.3150
    lon: 143.9555
  FJI:
    lat: -17.7134
    lon: 178.0650
  SLB:
    lat: -9.6457
    lon: 160.1562
  VUT:
    lat: -15.3767
    lon: 166.9592
  NCL:
    lat: -20.9043
    lon: 165.6180
  PYF:
    lat: -17.6797
    lon: -149.4068
  WLF:
    lat: -14.2938
    lon: -178.1165
  TON:
    lat: -21.1790
    lon: -175.1982
  KIR:
    lat: -3.3704
    lon: -168.7340
  TUV:
    lat: -7.1095
    lon: 177.6493
  NRU:
    lat: -0.5228
    lon: 166.9315
  PLW:
    lat: 7.5150
    lon: 134.5825
  MHL:
    lat: 7.1315
    lon: 171.1845
  FSM:
    lat: 7.4256
    lon: 150.5508
  PAN:
    lat: 8.5380
    lon: -80.7821
  CRI:
    lat: 9.9281
    lon: -84.0907
  NIC:
    lat: 12.8654
    lon: -85.2072
  HND:
    lat: 15.1999
    lon: -86.2419
  SLV:
    lat: 13.7942
    lon: -88.8965
  GTM:
    lat: 15.7835
    lon: -90.2308
  BLZ:
    lat: 17.1899
    lon: -88.4976
  JAM:
    lat: 18.1096
    lon: -77.2975
  HTI:
    lat: 18.9712
    lon: -72.2852
  DOM:
    lat: 18.7357
    lon: -70.1627
  CUB:
    lat: 21.5218
    lon: -77.7812
  BRB:
    lat: 13.1939
    lon: -59.5432
  TTO:
    lat: 10.6598
    lon: -61.5190
  GRD:
    lat: 12.2628
    lon: -61.6042
  LCA:
    lat: 13.9094
    lon: -60.9789
  VCT:
    lat: 12.9843
    lon: -61.2872
  ATG:
    lat: 17.0608
    lon: -61.7964
  KNA:
    lat: 17.3578
    lon: -62.7830
  DMA:
    lat: 15.4150
    lon: -61.3710
  BHS:
    lat: 25.0343
    lon: -77.3963
  CYM:
    lat: 19.3133
    lon: -81.2546
  TCA:
    lat: 21.6940
    lon: -71.7979
  AIA:
    lat: 18.2206
    lon: -63.0686
  VGB:
    lat: 18.4207
    lon: -64.6400
  MSR:
    lat: 16.7425
    lon: -62.1874
  GLP:
    lat: 16.2650
    lon: -61.5510
  MTQ:
    lat: 14.6415
    lon: -61.0242
  BLM:
    lat: 17.9000
    lon: -62.8333
  MAF:
    lat: 18.0708
    lon: -63.0501
  SXM:
    lat: 18.0333
    lon: -63.0500
  CUW:
    lat: 12.1696
    lon: -68.9900
  ABW:
    lat: 12.5211
    lon: -69.9683
  BES:
    lat: 12.1784
    lon: -68.2385